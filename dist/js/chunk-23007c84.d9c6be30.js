(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23007c84"],{"21c9":function(a,t,e){"use strict";var n=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("el-row",{style:a.mainStyle,attrs:{type:"flex",justify:"left"}},[e("el-col",[e("el-date-picker",{attrs:{type:"year",placeholder:"起始年份"},on:{change:a.beginChange},model:{value:a.beginYearInternal,callback:function(t){a.beginYearInternal=t},expression:"beginYearInternal"}})],1),e("el-col",{staticStyle:{margin:"auto","text-align":"center",color:"lightgray","font-size":"12px"}},[a._v(" 至 ")]),e("el-col",[e("el-date-picker",{attrs:{type:"year",placeholder:"终止年份"},on:{change:a.endChange},model:{value:a.endYearInternal,callback:function(t){a.endYearInternal=t},expression:"endYearInternal"}})],1)],1)},r=[],l={name:"YearRangeSelector",props:["beginYear","endYear","expand"],data:function(){return{beginYearInternal:this.beginYear,endYearInternal:this.endYear}},methods:{beginChange:function(a){null===a?this.$emit("update:beginYear",null):this.$emit("update:beginYear",a.getFullYear())},endChange:function(a){null===a?this.$emit("update:endYear",null):this.$emit("update:endYear",a.getFullYear())}},watch:{beginYearInternal:function(a){null!==a?this.$emit("update:beginYear",a.getFullYear()):this.$emit("update:beginYear",null)},endYearInternal:function(a){null!==a?this.$emit("update:endYear",a.getFullYear()):this.$emit("update:endYear",null)},beginYear:function(a){this.beginYearInternal=null!==a?new Date(a,1,1):null},endYear:function(a){this.endYearInternal=null!==a?new Date(a,1,1):null}},computed:{mainStyle:function(){return this.expand?"":"width: 55%"}}},s=l,o=(e("6e83"),e("2877")),i=Object(o["a"])(s,n,r,!1,null,"7bfa7c13",null);t["a"]=i.exports},"6c1c":function(a,t,e){},"6e83":function(a,t,e){"use strict";e("e4af")},"72ce":function(a,t,e){"use strict";e.r(t);var n=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("el-row",[e("el-col",{attrs:{span:11,offset:1}},[e("BigUserPredictSelectForm",{attrs:{"graph-data":a.graphData,"table-one-data":a.tableOneData,"table-two-data":a.tableTwoData},on:{"update:graphData":function(t){a.graphData=t},"update:graph-data":function(t){a.graphData=t},"update:tableOneData":function(t){a.tableOneData=t},"update:table-one-data":function(t){a.tableOneData=t},"update:tableTwoData":function(t){a.tableTwoData=t},"update:table-two-data":function(t){a.tableTwoData=t}}})],1),e("el-col",{attrs:{span:12}},[e("el-row",[e("ResultChart",{ref:"resultChart"})],1)],1)],1),e("el-row",[e("el-col",{attrs:{span:22,offset:1}},[e("ResultTable",{ref:"resultTable"})],1)],1)],1)},r=[],l=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("el-form",{attrs:{"label-position":"right","label-width":"auto"}},[e("el-form-item",{attrs:{label:"预测地区："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:a.postParams.region,callback:function(t){a.$set(a.postParams,"region",t)},expression:"postParams.region"}},a._l(a.knownRegions,(function(a){return e("el-option",{key:a,attrs:{label:a,value:a}})})),1)],1),e("el-form-item",{attrs:{label:"历史年份："}},[e("year-range-selector",{attrs:{"begin-year":a.postParams.historyBeginYear,"end-year":a.postParams.historyEndYear},on:{"update:beginYear":function(t){return a.$set(a.postParams,"historyBeginYear",t)},"update:begin-year":function(t){return a.$set(a.postParams,"historyBeginYear",t)},"update:endYear":function(t){return a.$set(a.postParams,"historyEndYear",t)},"update:end-year":function(t){return a.$set(a.postParams,"historyEndYear",t)}}})],1),e("el-form-item",{attrs:{label:"预测年份："}},[e("year-range-selector",{attrs:{"begin-year":a.postParams.beginYear,"end-year":a.postParams.endYear},on:{"update:beginYear":function(t){return a.$set(a.postParams,"beginYear",t)},"update:begin-year":function(t){return a.$set(a.postParams,"beginYear",t)},"update:endYear":function(t){return a.$set(a.postParams,"endYear",t)},"update:end-year":function(t){return a.$set(a.postParams,"endYear",t)}}})],1),e("el-form-item",{attrs:{label:"预测模型："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:a.postParams.method,callback:function(t){a.$set(a.postParams,"method",t)},expression:"postParams.method"}},a._l(a.knownMethods,(function(a){return e("el-option",{key:a,attrs:{label:a,value:a}})})),1)],1),e("el-form-item",{attrs:{label:"修改数据节点："}},[e("el-cascader",{attrs:{placeholder:"请选择",options:a.knownMetadata,"change-on-select":""},model:{value:a.addEntryParams.metaData,callback:function(t){a.$set(a.addEntryParams,"metaData",t)},expression:"addEntryParams.metaData"}})],1),null!==a.postParams.historyBeginYear&&null!==a.postParams.historyEndYear?e("el-form-item",{attrs:{label:"修改年份："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:a.addEntryParams.year,callback:function(t){a.$set(a.addEntryParams,"year",t)},expression:"addEntryParams.year"}},a._l(a.postParams.historyEndYear-a.postParams.historyBeginYear+1,(function(t){return e("el-option",{key:t+a.postParams.historyBeginYear-1,attrs:{label:t+a.postParams.historyBeginYear-1+" 年",value:t+a.postParams.historyBeginYear-1}})})),1)],1):a._e(),null===a.postParams.historyBeginYear||null===a.postParams.historyEndYear?e("el-form-item",[e("div",{staticStyle:{color:"darkred","font-size":"12px"}},[a._v(" 请先指定历史数据年份范围。 ")])]):a._e(),e("el-form-item",{attrs:{label:"更新值："}},[e("el-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:a.addEntryParams.value,callback:function(t){a.$set(a.addEntryParams,"value",t)},expression:"addEntryParams.value"}})],1),e("el-form-item",[e("el-button",{attrs:{size:"mini",disabled:!a.canAddEntry},on:{click:a.addEntry}},[a._v("加入修改项")])],1),0!==a.postParams.patches.length?e("el-form-item",[e("el-table",{attrs:{data:a.postParams.patches}},[e("el-table-column",{attrs:{label:"数据节点",prop:"metaData"}}),e("el-table-column",{attrs:{label:"数据年份",prop:"year"}}),e("el-table-column",{attrs:{label:"数据粒度",prop:"grain"}}),e("el-table-column",{attrs:{label:"值",prop:"value"}}),e("el-table-column",{attrs:{align:"center"},scopedSlots:a._u([{key:"default",fn:function(t){return[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return a.handleDelete(t.$index)}}},[a._v(" × ")])]}}],null,!1,943495059)})],1)],1):a._e(),e("el-form-item",{attrs:{label:"方案标签："}},[e("el-input",{attrs:{clearable:"",placeholder:"可留空"},model:{value:a.postParams.tag,callback:function(t){a.$set(a.postParams,"tag",t)},expression:"postParams.tag"}})],1),e("el-form-item",{attrs:{label:"加载方案："}},[e("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:"选择标签",size:"small"},model:{value:a.currentTag,callback:function(t){a.currentTag=t},expression:"currentTag"}},a._l(a.knownTags,(function(a){return e("el-option",{key:a.id,attrs:{label:a.id,value:a.id}})})),1),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",disabled:null===a.currentTag},on:{click:a.loadParameters}},[a._v("加载")])],1),e("el-form-item",[e("el-button",{attrs:{disabled:!a.canCommitQuery,type:"primary"},on:{click:a.performPrediction}},[a._v("预测")])],1)],1)},s=[],o=e("2909"),i=e("21c9"),u={name:"BigUserPredictSelectForm",components:{YearRangeSelector:i["a"]},data:function(){return{knownRegions:[],knownMethods:[],knownMetadata:[],graphDataInternal:[],tableOneDataInternal:[],tableTwoDataInternal:[],knownTags:[],currentTag:null,addEntryParams:{metaData:[],year:"",grain:"年",value:""},postParams:{historyBeginYear:null,historyEndYear:null,beginYear:null,endYear:null,method:"",region:"",patches:[],tag:null,tagType:"BIGUSER"}}},methods:{loadTags:function(){var a=this;this.$axios.get("/tags/query",{params:{tagType:"BIGUSER"}}).then((function(t){a.$data.knownTags=t.data.data}))},loadParameters:function(){var a=this;this.$axios.get("/params/predict/biguser",{params:{tag:this.$data.currentTag}}).then((function(t){a.$data.postParams=t.data.data}))},loadMetaData:function(){var a=this;this.$axios.get("/db/metadata").then((function(t){a.$data.knownMetadata=t.data.data}))},loadRegions:function(){var a=this;this.$axios.get("/region/query").then((function(t){a.$data.knownRegions=t.data.data}))},loadMethods:function(){var a=this;this.$axios.get("/method/bigdata/query").then((function(t){a.$data.knownMethods=t.data.data}))},addEntry:function(){var a=this.$data.addEntryParams;this.$data.postParams.patches.push({metaData:Object(o["a"])(a.metaData),grain:a.grain,year:a.year,value:a.value})},performPrediction:function(){var a=this;this.$axios.post("/predict/bigdata",this.$data.postParams).then((function(t){a.$data.graphDataInternal=t.data.data.graphData,a.$data.tableOneDataInternal=t.data.data.tableOneData,a.$data.tableTwoDataInternal=t.data.data.tableTwoData}))},handleDelete:function(a){this.$data.postParams.patches.remove(a,a)}},mounted:function(){this.loadMetaData(),this.loadRegions(),this.loadMethods(),this.loadTags()},computed:{canCommitQuery:function(){var a=this.$data.postParams;return null!==a.historyBeginYear&&null!==a.historyEndYear&&(null!==a.beginYear&&null!==a.endYear&&(0!==a.method.length&&0!==a.region.length))},canAddEntry:function(){var a=this.$data.addEntryParams;return 0!==a.metaData.length&&(0!==a.value.length&&0!==a.year.length)}},watch:{graphDataInternal:function(a){this.$emit("update:graphData",a)},tableOneDataInternal:function(a){this.$emit("update:tableOneData",a)},tableTwoDataInternal:function(a){this.$emit("update:tableTwoData",a)}},props:["graphData","tableOneData","tableTwoData"]},d=u,c=(e("d4d7"),e("2877")),p=Object(c["a"])(d,l,s,!1,null,"bafd8466",null),h=p.exports,m=e("c3ab"),b=e("f70a"),f={name:"BigUserPrediction",components:{ResultTable:b["a"],ResultChart:m["a"],BigUserPredictSelectForm:h},data:function(){return{graphData:[],tableOneData:[],tableTwoData:[]}},watch:{graphData:function(a){this.$refs.resultChart.graphData=a,this.$refs.resultChart.refreshChart()},tableOneData:function(a){this.$refs.resultTable.tableOneData=a},tableTwoData:function(a){this.$refs.resultTable.tableTwoData=a}}},g=f,y=Object(c["a"])(g,n,r,!1,null,"2d93eb83",null);t["default"]=y.exports},c3ab:function(a,t,e){"use strict";var n=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:a.graphData.length>0,expression:"graphData.length > 0"}],staticStyle:{"margin-left":"20px"}},[e("el-row",[e("div",{staticStyle:{width:"680px",height:"300px"},attrs:{id:a.uniqueId}})]),e("el-row",[e("el-form",[e("el-form-item",[e("el-button",{on:{click:a.exportImage}},[a._v("导出图像")])],1),e("el-form-item",{attrs:{label:"显示方式："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:a.currentDisplayMethod,callback:function(t){a.currentDisplayMethod=t},expression:"currentDisplayMethod"}},a._l(a.displayMethods,(function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.value}})})),1)],1)],1)],1)],1)},r=[],l=(e("4160"),e("d3b7"),e("ac1f"),e("1276"),e("5cc6"),e("9a8c"),e("a975"),e("735e"),e("c1ac"),e("d139"),e("3a7b"),e("d5d6"),e("82f8"),e("e91f"),e("60bd"),e("5f96"),e("3280"),e("3fcc"),e("ca91"),e("25a1"),e("cd26"),e("3c5d"),e("2954"),e("649e"),e("219c"),e("170b"),e("b39a"),e("72f7"),e("159b"),e("313e")),s=e("21a6");function o(a){for(var t=a.split(";base64,"),e=t[0].split(":")[1],n=window.atob(t[1]),r=n.length,l=new Uint8Array(r),s=0;s<r;++s)l[s]=n.charCodeAt(s);return new Blob([l],{type:e})}var i={data:function(){return{currentChart:void 0,graphData:[],params1st:{xTag:"xName",yTag:"yValue",xName:"",yName:""},params2nd:{xTag:"",yTag1st:"",yTag2nd:"",xName:"",yName:"",yName1st:"",yName2nd:""},displayMethods:[{label:"折线图",value:"line"},{label:"柱状图",value:"bar"},{label:"散点图",value:"scatter"}],currentDisplayMethod:"line"}},methods:{refreshChart:function(){var a=this.$data.params1st;void 0===this.currentChart&&(this.currentChart=l["init"](document.getElementById(this.uniqueId)));var t=[],e=[];this.$data.graphData.forEach((function(n){t.push(n[a.xTag]),e.push(n[a.yTag])}));var n={xAxis:{type:"category",name:a.xName,data:t},yAxis:{type:"value",name:a.yName},series:[{data:e,name:a.yName,type:this.$data.currentDisplayMethod}],legend:{orient:"horizontal",x:"center",y:"top"}};this.currentChart.setOption(n,!0)},refreshChart2nd:function(){var a=this.$data.params2nd;void 0===this.currentChart&&(this.currentChart=l["init"](document.getElementById(this.uniqueId)));var t=[],e=[],n=[];this.$data.graphData.forEach((function(r){t.push(r[a.xTag]),e.push(r[a.yTag1st]),n.push(r[a.yTag2nd])}));var r={xAxis:{type:"category",name:a.xName,data:t},yAxis:{type:"value",name:a.yName},series:[{data:e,name:a.yName1st,type:this.$data.currentDisplayMethod},{data:n,name:a.yName2nd,type:this.$data.currentDisplayMethod}],legend:{orient:"horizontal",x:"center",y:"top"}};this.currentChart.setOption(r,!0)},exportImage:function(){if(this.currentChart){var a=this.currentChart.getDataURL(),t=o(a);Object(s["saveAs"])(t,"chart.png")}}},watch:{currentDisplayMethod:function(){"2nd"===this.typee?this.refreshChart2nd():this.refreshChart()}},computed:{uniqueId:function(){return void 0!==this.uid?this.uid:"globalChart"}},props:["typee","uid"]},u=i,d=e("2877"),c=Object(d["a"])(u,n,r,!1,null,"5ad5f736",null);t["a"]=c.exports},d4d7:function(a,t,e){"use strict";e("6c1c")},e4af:function(a,t,e){},f70a:function(a,t,e){"use strict";var n=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("el-form",[e("el-form-item",{attrs:{label:"评价指标表："}},[e("el-table",{attrs:{data:a.tableOneData}},[e("el-table-column",{attrs:{prop:"index",label:"评价指标"}}),e("el-table-column",{attrs:{prop:"r2",label:"R2"}}),e("el-table-column",{attrs:{prop:"mape",label:"MAPE"}}),e("el-table-column",{attrs:{prop:"rmse",label:"RMSE"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{disabled:0===a.tableOneData.length},on:{click:a.exportTableOneSheet}},[a._v("导出评价指标表")])],1),e("el-form-item",{attrs:{label:"年份 − 预测值表："}},[e("el-table",{attrs:{data:a.tableTwoData}},[e("el-table-column",{attrs:{prop:"year",label:"年份"}}),e("el-table-column",{attrs:{prop:"predict",label:"预测值（MVW）"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{disabled:0===a.tableTwoData.length},on:{click:a.exportTableTwoSheet}},[a._v("导出预测结果表")])],1)],1)},r=[],l=e("f59f"),s=e("21a6"),o={name:"ResultTable",data:function(){return{tableOneData:[],tableTwoData:[]}},methods:{exportTableSheet:function(a,t){var e=l["parse"](a,{fields:t}),n=new Blob([e],{type:"text/csv"});Object(s["saveAs"])(n,"database.csv")},exportTableOneSheet:function(){this.exportTableSheet(this.$data.tableOneData,["index","r2","mape","rmse"])},exportTableTwoSheet:function(){this.exportTableSheet(this.$data.tableTwoData,["year","predict"])}}},i=o,u=e("2877"),d=Object(u["a"])(i,n,r,!1,null,"96eed4ac",null);t["a"]=d.exports}}]);
//# sourceMappingURL=chunk-23007c84.d9c6be30.js.map