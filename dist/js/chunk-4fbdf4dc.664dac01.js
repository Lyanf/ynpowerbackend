(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4fbdf4dc"],{"0ae5":function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-row",[e("el-col",{attrs:{offset:1,span:9}},[e("MetaDataTree",{attrs:{category:t.category,"data-result":t.tableData,context:t.context},on:{"update:category":function(a){t.category=a},"update:dataResult":function(a){t.tableData=a},"update:data-result":function(a){t.tableData=a},"update:context":function(a){t.context=a}}})],1),e("el-col",{attrs:{span:14}},[e("DataCRUDTable",{attrs:{category:t.category,"display-data":t.tableData,context:t.context},on:{"update:category":function(a){t.category=a},"update:displayData":function(a){t.tableData=a},"update:display-data":function(a){t.tableData=a},"update:context":function(a){t.context=a}}})],1)],1)},o=[],r=e("8e4a"),s=e("4166"),i={name:"DataBaseCRUD",components:{DataCRUDTable:s["a"],MetaDataTree:r["a"]},data:function(){return{tableData:[],category:[],context:{}}}},l=i,c=e("2877"),d=Object(c["a"])(l,n,o,!1,null,"2d75f98b",null);a["default"]=d.exports},2371:function(t,a,e){},4166:function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-button",{on:{click:t.addRow}},[t._v("新增")]),e("el-button",{attrs:{disabled:0===t.dataEntryLength},on:{click:t.exportTableSheet}},[t._v("表格导出")]),e("d2-crud",{ref:"d2Crud",attrs:{columns:t.columns,data:t.displayData,"add-template":t.addTemplate,rowHandle:t.rowHandle,"edit-template":t.editTemplate},on:{"row-add":t.handleRowAdd,"dialog-cancel":t.handleDialogCancel,"row-edit":t.handleRowEdit,"row-remove":t.handleRowRemove}}),e("div",{staticStyle:{color:"darkgray","font-size":"12px"}},[t._v(" 共 "+t._s(t.dataEntryLength)+" 条 ")])],1)},o=[],r=(e("159b"),e("f59f")),s=e("21a6"),i={name:"DataCRUDTable",props:["displayData","category","context"],computed:{dataEntryLength:function(){return void 0===this.displayData?0:this.displayData.length}},data:function(){return{columns:[{title:"键",key:"key"},{title:"值",key:"value"}],addTemplate:{key:{title:"键"},value:{title:"值"}},editTemplate:{key:{title:"键"},value:{title:"值"}},rowHandle:{edit:{text:"编辑",size:"small"},remove:{size:"small",fixed:"right",confirm:!0}}}},methods:{addRow:function(){this.$refs.d2Crud.showDialog({mode:"add"})},exportTableSheet:function(){var t=[];this.$data.columns.forEach((function(a){t.push(a.key)})),console.log(t);var a=r["parse"](this.displayData,{fields:t}),e=new Blob([a],{type:"text/csv"});Object(s["saveAs"])(e,"database.csv")},handleRowAdd:function(t,a){var e=this;this.$axios.post("/db/create",{context:this.context,newData:{key:t.key,value:t.value}}).then((function(n){console.log(n),e.$messenger.success("添加成功。"),e.displayData.push(t),a()}))},handleDialogCancel:function(t){t()},handleRowEdit:function(t,a){var e=this,n=t.index,o=t.row;this.$axios.post("/db/update",{category:this.category,originData:this.displayData[n],modifiedData:o}).then((function(t){console.log(t),e.$messenger.success("编辑成功。"),e.displayData[n]=o,a()}))},handleRowRemove:function(t,a){var e=this,n=t.index;t.row;this.$axios.post("/db/delete",{category:this.category,originData:this.displayData[n]}).then((function(t){console.log(t),e.$messenger.success("删除成功。"),e.displayData.remove(n),a()}))}}},l=i,c=e("2877"),d=Object(c["a"])(l,n,o,!1,null,"b2a644fa",null);a["a"]=d.exports},"8e4a":function(t,a,e){"use strict";var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-form",{attrs:{type:"flex",justify:"right"}},[e("el-form-item",{attrs:{label:"数据节点："}},[e("el-cascader",{ref:"cascader",staticStyle:{width:"55%"},attrs:{id:"cascader",options:t.metaDataTree,"change-on-select":""},model:{value:t.postParams.category,callback:function(a){t.$set(t.postParams,"category",a)},expression:"postParams.category"}})],1),e("el-form-item",{attrs:{label:"地区选择："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.postParams.region,callback:function(a){t.$set(t.postParams,"region",a)},expression:"postParams.region"}},t._l(t.knownRegions,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),e("el-form-item",{attrs:{label:"粒度选择："}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:t.postParams.grain,callback:function(a){t.$set(t.postParams,"grain",a)},expression:"postParams.grain"}},t._l(t.knownGrains,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),e("el-form-item",{attrs:{label:"年份选择："}},[e("year-range-selector",{attrs:{"begin-year":t.postParams.beginYear,"end-year":t.postParams.endYear},on:{"update:beginYear":function(a){return t.$set(t.postParams,"beginYear",a)},"update:begin-year":function(a){return t.$set(t.postParams,"beginYear",a)},"update:endYear":function(a){return t.$set(t.postParams,"endYear",a)},"update:end-year":function(a){return t.$set(t.postParams,"endYear",a)}}})],1),e("el-form-item",[e("el-button",{attrs:{disabled:!t.canMakeQuery,type:"primary"},on:{click:t.performQuery}},[t._v("查找")])],1)],1)],1)},o=[],r=e("21c9"),s={name:"MetaDataTree",props:["category","dataResult","context"],components:{YearRangeSelector:r["a"]},data:function(){return{metaDataTree:[],knownRegions:[],knownGrains:[],dataResultInternal:this.dataResult,postParams:{category:[],region:"",grain:"",beginYear:null,endYear:null}}},computed:{canMakeQuery:function(){var t=this.$data.postParams;return 0!==t.region.length&&(0!==t.grain.length&&(null!==t.beginYear&&null!==t.endYear&&t.category!==[]))}},watch:{dataResultInternal:function(t){this.$emit("update:dataResult",t)},"postParams.category":function(t){this.$emit("update:category",t)},postParams:{handler:function(t){this.$emit("update:context",t)},deep:!0}},methods:{loadMetaData:function(){var t=this;this.$axios.get("/db/metadata").then((function(a){t.$data.metaDataTree=a.data.data}))},loadRegions:function(){var t=this;this.$axios.get("/region/query").then((function(a){t.$data.knownRegions=a.data.data}))},loadGrains:function(){var t=this;this.$axios.get("/grain/query").then((function(a){t.$data.knownGrains=a.data.data}))},performQuery:function(){var t=this;this.$axios.post("/db/query",this.$data.postParams).then((function(a){t.$data.dataResultInternal=a.data.data}))}},mounted:function(){this.loadMetaData(),this.loadRegions(),this.loadGrains()}},i=s,l=(e("f873"),e("2877")),c=Object(l["a"])(i,n,o,!1,null,"9a465c9a",null);a["a"]=c.exports},f873:function(t,a,e){"use strict";e("2371")}}]);
//# sourceMappingURL=chunk-4fbdf4dc.664dac01.js.map