(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-474192f2"],{"0ae5":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:1,span:9}},[a("MetaDataTree",{attrs:{category:e.category,"data-result":e.tableData,context:e.context},on:{"update:category":function(t){e.category=t},"update:dataResult":function(t){e.tableData=t},"update:data-result":function(t){e.tableData=t},"update:context":function(t){e.context=t}}})],1),a("el-col",{attrs:{span:14}},[a("DataCRUDTable",{attrs:{category:e.category,"display-data":e.tableData,context:e.context},on:{"update:category":function(t){e.category=t},"update:displayData":function(t){e.tableData=t},"update:display-data":function(t){e.tableData=t},"update:context":function(t){e.context=t}}})],1)],1)},r=[],o=a("8e4a"),l=a("4166"),i={name:"DataBaseCRUD",components:{DataCRUDTable:l["a"],MetaDataTree:o["a"]},data:function(){return{tableData:[],category:[],context:{}}}},s=i,c=a("2877"),d=Object(c["a"])(s,n,r,!1,null,"2d75f98b",null);t["default"]=d.exports},"21c9":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{style:e.mainStyle,attrs:{type:"flex",justify:"left"}},[a("el-col",[a("el-date-picker",{attrs:{type:"year",placeholder:"起始年份"},on:{change:e.beginChange},model:{value:e.beginYearInternal,callback:function(t){e.beginYearInternal=t},expression:"beginYearInternal"}})],1),a("el-col",{staticStyle:{margin:"auto","text-align":"center",color:"lightgray","font-size":"12px"}},[e._v(" 至 ")]),a("el-col",[a("el-date-picker",{attrs:{type:"year",placeholder:"终止年份"},on:{change:e.endChange},model:{value:e.endYearInternal,callback:function(t){e.endYearInternal=t},expression:"endYearInternal"}})],1)],1)},r=[],o={name:"YearRangeSelector",props:["beginYear","endYear","expand"],data:function(){return{beginYearInternal:this.beginYear,endYearInternal:this.endYear}},methods:{beginChange:function(e){null===e?this.$emit("update:beginYear",null):this.$emit("update:beginYear",e.getFullYear())},endChange:function(e){null===e?this.$emit("update:endYear",null):this.$emit("update:endYear",e.getFullYear())}},watch:{beginYearInternal:function(e){null!==e?this.$emit("update:beginYear",e.getFullYear()):this.$emit("update:beginYear",null)},endYearInternal:function(e){null!==e?this.$emit("update:endYear",e.getFullYear()):this.$emit("update:endYear",null)},beginYear:function(e){this.beginYearInternal=null!==e?new Date(e,1,1):null},endYear:function(e){this.endYearInternal=null!==e?new Date(e,1,1):null}},computed:{mainStyle:function(){return this.expand?"":"width: 55%"}}},l=o,i=(a("6e83"),a("2877")),s=Object(i["a"])(l,n,r,!1,null,"7bfa7c13",null);t["a"]=s.exports},2371:function(e,t,a){},4166:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{on:{click:e.addRow}},[e._v("新增")]),a("el-button",{attrs:{disabled:0===e.dataEntryLength},on:{click:e.exportTableSheet}},[e._v("表格导出")]),a("d2-crud",{ref:"d2Crud",attrs:{columns:e.columns,data:e.displayData,"add-template":e.addTemplate,rowHandle:e.rowHandle,"edit-template":e.editTemplate},on:{"row-add":e.handleRowAdd,"dialog-cancel":e.handleDialogCancel,"row-edit":e.handleRowEdit,"row-remove":e.handleRowRemove}}),a("div",{staticStyle:{color:"darkgray","font-size":"12px"}},[e._v(" 共 "+e._s(e.dataEntryLength)+" 条 ")])],1)},r=[],o=(a("159b"),a("f59f")),l=a("21a6"),i={name:"DataCRUDTable",props:["displayData","category","context"],computed:{dataEntryLength:function(){return void 0===this.displayData?0:this.displayData.length}},data:function(){return{columns:[{title:"键",key:"key"},{title:"值",key:"value"}],addTemplate:{key:{title:"键"},value:{title:"值"}},editTemplate:{key:{title:"键"},value:{title:"值"}},rowHandle:{edit:{text:"编辑",size:"small"},remove:{size:"small",fixed:"right",confirm:!0}}}},methods:{addRow:function(){this.$refs.d2Crud.showDialog({mode:"add"})},exportTableSheet:function(){var e=[];this.$data.columns.forEach((function(t){e.push(t.key)})),console.log(e);var t=o["parse"](this.displayData,{fields:e}),a=new Blob([t],{type:"text/csv"});Object(l["saveAs"])(a,"database.csv")},handleRowAdd:function(e,t){var a=this;this.$axios.post("/db/create",{context:this.context,newData:{key:e.key,value:e.value}}).then((function(n){console.log(n),a.$messenger.success("添加成功。"),a.displayData.push(e),t()}))},handleDialogCancel:function(e){e()},handleRowEdit:function(e,t){var a=this,n=e.index,r=e.row;this.$axios.post("/db/update",{category:this.category,originData:this.displayData[n],modifiedData:r}).then((function(e){console.log(e),a.$messenger.success("编辑成功。"),a.displayData[n]=r,t()}))},handleRowRemove:function(e,t){var a=this,n=e.index;e.row;this.$axios.post("/db/delete",{category:this.category,originData:this.displayData[n]}).then((function(e){console.log(e),a.$messenger.success("删除成功。"),a.displayData.remove(n),t()}))}}},s=i,c=a("2877"),d=Object(c["a"])(s,n,r,!1,null,"b2a644fa",null);t["a"]=d.exports},"6e83":function(e,t,a){"use strict";a("e4af")},"8e4a":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{attrs:{type:"flex",justify:"right"}},[a("el-form-item",{attrs:{label:"数据节点："}},[a("el-cascader",{ref:"cascader",staticStyle:{width:"55%"},attrs:{id:"cascader",options:e.metaDataTree,"change-on-select":""},model:{value:e.postParams.category,callback:function(t){e.$set(e.postParams,"category",t)},expression:"postParams.category"}})],1),a("el-form-item",{attrs:{label:"地区选择："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.postParams.region,callback:function(t){e.$set(e.postParams,"region",t)},expression:"postParams.region"}},e._l(e.knownRegions,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"粒度选择："}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.postParams.grain,callback:function(t){e.$set(e.postParams,"grain",t)},expression:"postParams.grain"}},e._l(e.knownGrains,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"年份选择："}},[a("year-range-selector",{attrs:{"begin-year":e.postParams.beginYear,"end-year":e.postParams.endYear},on:{"update:beginYear":function(t){return e.$set(e.postParams,"beginYear",t)},"update:begin-year":function(t){return e.$set(e.postParams,"beginYear",t)},"update:endYear":function(t){return e.$set(e.postParams,"endYear",t)},"update:end-year":function(t){return e.$set(e.postParams,"endYear",t)}}})],1),a("el-form-item",[a("el-button",{attrs:{disabled:!e.canMakeQuery,type:"primary"},on:{click:e.performQuery}},[e._v("查找")])],1)],1)],1)},r=[],o=a("21c9"),l={name:"MetaDataTree",props:["category","dataResult","context"],components:{YearRangeSelector:o["a"]},data:function(){return{metaDataTree:[],knownRegions:[],knownGrains:[],dataResultInternal:this.dataResult,postParams:{category:[],region:"",grain:"",beginYear:null,endYear:null}}},computed:{canMakeQuery:function(){var e=this.$data.postParams;return 0!==e.region.length&&(0!==e.grain.length&&(null!==e.beginYear&&null!==e.endYear&&e.category!==[]))}},watch:{dataResultInternal:function(e){this.$emit("update:dataResult",e)},"postParams.category":function(e){this.$emit("update:category",e)},postParams:{handler:function(e){this.$emit("update:context",e)},deep:!0}},methods:{loadMetaData:function(){var e=this;this.$axios.get("/db/metadata").then((function(t){e.$data.metaDataTree=t.data.data}))},loadRegions:function(){var e=this;this.$axios.get("/region/query").then((function(t){e.$data.knownRegions=t.data.data}))},loadGrains:function(){var e=this;this.$axios.get("/grain/query").then((function(t){e.$data.knownGrains=t.data.data}))},performQuery:function(){var e=this;this.$axios.post("/db/query",this.$data.postParams).then((function(t){e.$data.dataResultInternal=t.data.data}))}},mounted:function(){this.loadMetaData(),this.loadRegions(),this.loadGrains()}},i=l,s=(a("f873"),a("2877")),c=Object(s["a"])(i,n,r,!1,null,"9a465c9a",null);t["a"]=c.exports},e4af:function(e,t,a){},f873:function(e,t,a){"use strict";a("2371")}}]);
//# sourceMappingURL=chunk-474192f2.4704c565.js.map